{% extends "master.html" %}

{% block extJS %}
<script src="{{url_for('static', filename='js/customer/deliver_view.js')}}" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
//<![CDATA[
	$(document).ready(function(){
		$(".order_add_info_tab_div").tabs();
	});		
//]]>
</script>
{% endblock %}

{% block content %}
<input type="hidden" name="id" id="id" value="{{header.id}}"/>

<div class="order_add_div">
	<div class="order_add_div_header">送货单详情</div>
	
	<div class="order_add_div_body">
	
		<table border="1" cellpadding="5" cellspacing="5">
			<tr>
				<td width="200">{{_('3rd Party Supplier')}}</td>
				<td width="200">{{values.get('supplier','')|f}}</td>
			</tr>
			<tr>
				<td>{{_('Deliver Number')}}</td>
				<td>{{values.get('no','')|f}}</td>
			</tr>
			<tr>
				<td>{{_('Destination')}}</td>
				<td>{{values.get('destination_address','')|f}}</td>
			</tr>
			<tr>
				<td>{{_('Supplier Contact')}}</td>
				<td>{{values.get('supplier_contact','')|f}}</td>
			</tr>
			<tr>
				<td>{{_('Supplier Tel')}}</td>
				<td>{{values.get('supplier_tel','')|f}}</td>
			</tr>
			<tr>
				<td>{{_('Expect Time')}}</td>
				<td>{{values.get('expect_time','')|f}}</td>
			</tr>
			<tr>
				<td>{{_('Remark')}}</td>
				<td>{{values.get('remark','')|f}}</td>
			</tr>
			<tr>
				<td>{{_('Create Time')}}</td>
				<td>{{values.get('create_time','')|ft}}</td>
			</tr>
			<tr>
				<td>{{_('Creator')}}</td>
				<td>{{values.get('create_by','')|f}}</td>
			</tr>
			<tr>
				<td>{{_('Update Time')}}</td>
				<td>{{values.get('update_time','')|ft}}</td>
			</tr>
			<tr>
				<td>{{_('Last Updator')}}</td>
				<td>{{values.get('update_by','')|f}}</td>
			</tr>
			<tr>
				<td>{{_('Status')}}</td>
				<td>{{values.get('status','')|showStatus}}</td>
			</tr>
		</table>
		<br />
		<table border="1" cellpadding="5" cellspacing="5">
			<thead>
				<tr class="field_head">
					<th>{{_('Order Number')}}</th>
					<th>{{_('Source Station')}}</th>
					<th>{{_('Destination Station')}}</th>
					<th>{{_('Item')}}</th>
					<th>{{_('Qty')}}</th>
					<th>{{_('Vol')}}</th>
					<th>{{_('Weight')}}</th>
					<th>{{_('Destination Contact')}}</th>
					<th>{{_('Destination Tel')}}</th>
					<th>{{_('Update Time')}}</th>
					<th>{{_('Last Updator')}}</th>
				</tr>
			</thead>
			{% for d in details %}
				<tr class="data_table_tr {{ loop.cycle('data_table_tr_odd', 'data_table_tr_even') }}">
					<th>{{d.order_header.ref_no}}</th>
					<td>{{d.order_header.source_station}}</td>
					<td>{{d.order_header.destination_station|f}}</td>
					<td>{{d.order_header.item|f}}</td>
					<td>{{d.order_header.qty|f}}</td>
					<td>{{d.order_header.vol|f}}</td>
					<td>{{d.order_header.weight|f}}</td>
					<td>{{d.order_header.destination_contact|f}}</td>
					<td>{{d.order_header.destination_tel|f}}</td>
					<td>{{d.order_header.update_time|ft}}</td>
					<td>{{d.order_header.update_by|f}}</td>
				</tr>
			{% endfor %}
		</table>
		
		<br />
		
		
		
		<div class="order_add_info_tab_div">
			<div class="order_add_info_tab_header">
				<ul>
					<li><a href="#tabs-1">发货详情</a></li>
					<li><a href="#tabs-2">运输信息</a></li>
					<li><a href="#tabs-3">货物到达</a></li>
					<li><a href="#tabs-5">历史记录</a></li>
					
					<!-- 
					<li><a href="#tabs-5">提货信息</a></li>
					<li><a href="#tabs-6">财务信息</a></li>
					 -->
				</ul>
			</div>
			
			
			<!-- send out -->
			<div class="order_add_info_tab_body" id="tabs-1">
				{% if header.status < SEND_OUT[0]%}
					<table>
						<tr>
							<td valign="top">{{_('Time')}}</td>
							<td valign="top"><input type="text" name="send_out_time" id="send_out_time" value="{{SYSTEM_NOW()|fd}}" class="datepicker"/></td>
						</tr>
						<tr>
							<td valign="top">{{_('Remark')}}</td>
							<td valign="top"><textarea name="send_out_remark" id="send_out_remark">运货单 : {{header.no}} 货物已发货。</textarea></td>
						</tr>
					</table>
					<p><input type="button" value="确认发货" onclick="save_sendout()"/></p>
				{% else %}
					<p>货物已发出。</p>
				{% endif %}
			</div>
			
			<!-- transit -->
			<div class="order_add_info_tab_body" id="tabs-2">
				<table>
					<tr>
						<td valign="top">{{_('Time')}}</td>
						<td valign="top"><input type="text" name="transit_time" id="transit_time" value="{{SYSTEM_NOW()|fd}}" class="datepicker"/></td>
					</tr>
					<tr>
						<td valign="top">{{_('Remark')}}</td>
						<td valign="top"><textarea name="transit_remark" id="transit_remark"></textarea></td>
					</tr>
				</table>
				<p><input type="button" value="{{_('Add')}}" onclick="save_transit()"/></p>
			<table>
			<br />
			<thead>
				<tr class="field_head">
					<th align="center">{{_('Time')}}</th>
					<th align="center" style="width:600px">{{_('Remark')}}</th>
				</tr>
			<thead>
			<tbody id="transit_list">
				{% for t in header.get_logs() %}
					<tr class="data_table_tr">
						<td>{{t.transfer_date|ft}}</td>
						<td>{{t.remark|f}}</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
			</div>
			
			
			<div class="order_add_info_tab_body" id="tabs-3">
				{% if header.status < GOODS_ARRIVED[0]%}
						<table>
							<tr>
								<td valign="top">{{_('Arrival Time')}}</td>
								<td valign="top"><input type="text" name="arrived_time" id="arrived_time" class="datepicker" value="{{SYSTEM_NOW()|fd}}"/></td>
							</tr>
							<tr>
								<td valign="top">{{_('Remark')}}</td>
								<td valign="top"><textarea name="arrived_remark" id="arrived_remark">运货单 : {{header.no}} 货物已到达目的地 ：{{header.destination_address}}。</textarea></td>
							</tr>
						</table>
						
						<p><input type="button" value="确认货物到达" onclick="save_arrived()"/></p>
				{% else %}
					<p>货物已到达。</p>
				{% endif %}
				
			</div>
			
			<!-- history -->
			<div class="order_add_info_tab_body" id="tabs-5">
			
			</div>
		</div>
	</div>
</div>
{% endblock %}