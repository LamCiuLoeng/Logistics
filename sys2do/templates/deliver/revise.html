{% extends "master.html" %}

{% block extJS %}

<script src="{{url_for('static', filename='js/customer/deliver_add.js')}}" type="text/javascript"></script>

<script language="JavaScript" type="text/javascript">
//<![CDATA[
	var header_have_update = 0
	
	$(document).ready(function(){
		$("input,select,remark",'form').change(function(){
			header_have_update = 1;
		});
	});

	function tosave(){
		var msg = new Array();
		
		if(!$("#supplier_id").val()){
			msg.push('请选择承运商！');
		}
		if(!$("#no").val()){
			msg.push('请填写送货单号码！');
		}
		if(!$("#destination_province_id").val()){
			msg.push('请填写目的地！');
		}
		if(!$("#supplier_contact").val()){
			msg.push('请填写承运商联系人！');
		}
		if(!$("#supplier_tel").val()){
			msg.push('请填写承运商电话！');
		}
		if(!$("#expect_time").val()){
			msg.push('请填写到达预期！');
		}
		if(!$("#amount").val()){
			msg.push('请填写费用！');
		}
		
		if(msg.length>0){
			show_error(msg.join('<br />'));
		}else{
			show_hold('正在保存，请稍候。。。');
			$("form").submit();
		}
	}
	
	function toreturn(){
		if(header_have_update){
			return redirect_alert("{{MSG_LEAVE_WITHOUT_SAVING}}","{{request.referrer}}");
		}else{
			redirect("{{request.referrer}}");
		}
	}	
	
//]]>
</script>
{% endblock %}


{% block inner_menu %}
<div class="inner_menu">
	<ul>
    	<li><img src="/static/images/system/order_manage_25.jpg" width="71" height="21" id="Image1" onmouseover="MM_swapImage('Image1','','/static/images/system/order_manage_h_25.jpg',1)" onmouseout="MM_swapImgRestore()" onclick="return toreturn();"/></li>
        {% if 'UPDATE_DELIVER' is get_permission%}
        <li><input type="image" src="/static/images/system/order_manage_33.jpg" width="77" height="21" id="Image3" onmouseover="MM_swapImage('Image3','','/static/images/system/order_manage_h_33.jpg',1)" onmouseout="MM_swapImgRestore()" onclick="tosave()"/></li>
        {% endif %}
    </ul>
</div>
{% endblock %}
       


{% block content %}
	<div style="background-color: #fff;padding: 10px;">
		
	<form method="post" action="{{url_for('.view',action='deliver_save_revise')}}">
		<input type="hidden" name="id" value="{{header.id}}"/>
		<table border="1" cellpadding="3" cellspacing="3">
			<tbody>
				<tr>
					<td width="100" height="30" align="right">{{_('3rd Party Supplier')}}</td>
					<td width="12">&nbsp;</td>
					<td width="600">
					  <select name="supplier_id" id="supplier_id" class="field order_add_div_body_input must_input" style="width: 200px">
							<option value=""></option>
							{% for s in MASTER_ALL('Supplier') %}
								{% if s.id == header.supplier_id %}
									<option value="{{s.id}}" selected>{{s}}</option>
								{% else %}
									<option value="{{s.id}}">{{s}}</option>
								{% endif %}
							{% endfor %}
						</select>
					</td>
				<tr>
					<td height="30" align="right">{{_('Destination')}}</td>
					<td>&nbsp;</td>
				  <td>
					<select name="destination_province_id" id="destination_province_id" style="width:150px" class="field order_add_div_body_input must_input" style="width: 150px">
		    	      <option value=""></option>
		    	      {% for p in MASTER_ALL('Province') %}
		    	          {% if p.id == header.destination_province_id %}
		    	              <option value="{{p.id}}" selected="selected">{{p}}</option>
		    	          {% else %}
		    	              <option value="{{p.id}}">{{p}}</option>
		    	          {% endif %}
		    	      {% endfor %}
		    	  </select>
		    	      <select name="destination_city_id" id="destination_city_id" class="field order_add_div_body_input " style="width: 150px">
		    	      {% for c in destination_cites %}
		    	          {% if c.id == header.destination_city_id %}
		    	          	<option value="{{c.id}}" selected="selected">{{c}}</option>
		    	          {% else %}
		    	          	<option value="{{c.id}}">{{c}}</option>
		    	          {% endif %}
		    	        {% endfor %}
		    	      </select>				  
				  </td>
				</tr>
					<tr>
						<td height="30" align="right">{{_('Deliver Number')}}</td>
						<td>&nbsp;</td>
					  <td><input type="text" name="no" id="no" class="field order_add_div_body_input must_input" style="width: 200px" value="{{header.no|f}}"/></td>
					</tr>
				<tr>
					<td height="30" align="right">{{_('Supplier Contact')}}</td>
					<td>&nbsp;</td>
				  <td><input type="text" name="supplier_contact" id="supplier_contact" class="field order_add_div_body_input must_input" style="width: 200px" value="{{header.supplier_contact|f}}"/></td>
				</tr>
				<tr>
					<td height="30" align="right">{{_('Supplier Tel')}}</td>
					<td>&nbsp;</td>
				  <td><input type="text" name="supplier_tel" id="supplier_tel" class="field order_add_div_body_input must_input" style="width: 200px" value="{{header.supplier_tel|f}}"/></td>
				</tr>
				<tr>
					<td height="30" align="right">{{_('Expect Time')}}</td>
					<td>&nbsp;</td>
				  <td><input type="text" name="expect_time" id="expect_time" class="datepicker order_add_div_body_input must_input" style="width: 200px" value="{{header.expect_time|f}}"/></td>
				</tr>
				<tr>
					<td height="30" align="right">保险费用</td>
					<td>&nbsp;</td>
				  <td><input type="text" name="insurance_charge" id="insurance_charge" class="numeric order_add_div_body_input compute" style="width: 200px" value="{{header.insurance_charge|f}}"/></td>
				</tr>
				<tr>
					<td height="30" align="right">送货费用</td>
					<td>&nbsp;</td>
				  <td><input type="text" name="sendout_charge" id="sendout_charge" class="numeric order_add_div_body_input compute" style="width: 200px" value="{{header.sendout_charge|f}}"/></td>
				</tr>
				<tr>
					<td height="30" align="right">上门接货费用</td>
					<td>&nbsp;</td>
				  <td><input type="text" name="receive_charge" id="receive_charge" class="numeric order_add_div_body_input compute" style="width: 200px" value="{{header.receive_charge|f}}"/></td>
				</tr>
				<tr>
					<td height="30" align="right">包装费用</td>
					<td>&nbsp;</td>
				  <td><input type="text" name="package_charge" id="package_charge" class="numeric order_add_div_body_input compute" style="width: 200px" value="{{header.package_charge|f}}"/></td>
				</tr>
				<tr>
					<td height="30" align="right">其它费用</td>
					<td>&nbsp;</td>
				  <td><input type="text" name="other_charge" id="other_charge" class="numeric order_add_div_body_input compute" style="width: 200px" value="{{header.other_charge|f}}"/></td>
				</tr>
				<tr>
					<td height="30" align="right">总费用</td>
					<td>&nbsp;</td>
				  <td><input type="text" name="amount" id="amount" class="numeric order_add_div_body_input must_input" style="width: 200px" value="{{header.amount|f}}"/></td>
				</tr>
				<tr>
					<td height="30" align="right">{{_('Remark')}}</td>
					<td>&nbsp;</td>
				  <td><textarea name="remark" id="remark" class="field" style="width: 200px">{{header.remark|f}}</textarea></td>
				</tr>
			</tbody>
		</table>
  <br />
		<br />
		
		<table border="1" cellpadding="3" cellspacing="3" style="width:1200px">
			<thead>
				<tr class="field_head">
					<th style="width:200px">{{_('Order Number')}}</th>
					<th style="width:200px">{{_('Source Station')}}</th>
					<th style="width:200px">{{_('Destination Station')}}</th>
					<th style="width:50px">{{_('Qty')}}</th>
					<th style="width:50px">{{_('Vol')}}</th>
					<th style="width:50px">{{_('Weight')}}</th>
					<th style="width:100px">{{_('Destination Contact')}}</th>
					<th style="width:100px">{{_('Destination Tel')}}</th>
					<th style="width:150px">{{_('Create Time')}}</th>
					<th style="width:150px">{{_('Creator')}}</th>
				</tr>
			</thead>
			{% for d in header.details %}		
				<tr class="data_table_tr {{ loop.cycle('data_table_tr_odd', 'data_table_tr_even') }}">
					<th>{{d.order_header.ref_no|f}}<input type="hidden" name="detail_{{d.id}}" value="{{d.id}}"/></th>
					<td>{{d.order_header.source_province}}{{d.source_city}}</td>
					<td>{{d.order_header.destination_province}}{{d.destination_city}}</td>
					<td>{{d.order_header.qty|f}}</td>
					<td>{{d.order_header.vol|f}}</td>
					<td>{{d.order_header.weight|f}}</td>
					<td>{{d.order_header.destination_contact|f}}</td>
					<td>{{d.order_header.destination_tel|f}}</td>
					<td>{{d.order_header.create_time|ft}}</td>
					<td>{{d.order_header.create_by|ifFalse}}</td>
				</tr>
				<tr class="data_table_tr data_table_tr_even">
					<td colspan="20" style="text-align:right">
						<span>保险费用</span><input type="text" name="insurance_charge_{{d.id}}" value="{{d.insurance_charge|f}}" class="numeric number_input_right"/>&nbsp;
						<span>送货费用</span><input type="text" name="sendout_charge_{{d.id}}" value="{{d.sendout_charge|f}}" class="numeric number_input_right"/>&nbsp;
						<span>上门接货费用</span><input type="text" name="receive_charge_{{d.id}}" value="{{d.receive_charge|f}}" class="numeric number_input_right"/>&nbsp;
						<span>包装费用</span><input type="text" name="package_charge_{{d.id}}" value="{{d.package_charge|f}}" class="numeric number_input_right"/>&nbsp;
						<span>装货费用</span><input type="text" name="load_charge_{{d.id}}" value="{{d.load_charge|f}}" class="numeric number_input_right"/>&nbsp;
						<span>卸货费用</span><input type="text" name="unload_charge_{{d.id}}" value="{{d.unload_charge|f}}" class="numeric number_input_right"/>&nbsp;
						<span>其它费用</span><input type="text" name="other_charge_{{d.id}}" value="{{d.other_charge|f}}" class="numeric number_input_right"/>&nbsp;
						<span>单笔总费用</span><input type="text" name="amount_{{d.id}}" value="{{d.amount|f}}" class="numeric number_input_right"/>&nbsp;
					</td>
				</tr>
			{% endfor %}
				<tr class="data_table_tr">
					<td>&nbsp;</td>
					<td colspan="2" style="text-align:left">合计</td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
					<td colspan="20">&nbsp;</td>
				</tr>
		</table>
		<br />	
	</form>
	</div>
	
{% endblock %}