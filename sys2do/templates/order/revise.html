{% extends "master.html" %}


{% block extCSS %}

<style type="text/css">

</style>
{% endblock %}

{% block extJS %}
<script src="{{url_for('static', filename='js/customer/order_revise.js')}}" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
//<![CDATA[
	$(document).ready(function(){
		$(".order_add_info_tab_div").tabs();
		
		$(".compute").each(function(){
			var t = $(this);
			t.change(compute);
		});
		
		function compute(){
		var qty = $("#qty").val();
		var qty_ratio = $("#qty_ratio").val();
		var vol = $("#vol").val();
		var vol_ratio = $("#vol_ratio").val();
		var weight = $("#weight").val();
		var weight_ratio = $("#weight_ratio").val();
		var amount = qty * qty_ratio + vol * vol_ratio + weight * weight_ratio;
		$("#amount").val(amount);
	}
	});	
	
	
	function todelete() {
    	if(confirm('{{_(MSG_CONFIRM_DELETE)}}')){
    		var url = "{{url_for('.view', action = 'delete',id=header.id)|safe}}";
    		redirect(url);
    	}else{
    		return false;
    	}
	}
		
//]]>
</script>

{% endblock %}

{% block inner_menu %}
<div class="inner_menu">
	<ul>
    	<li><img src="/static/images/system/order_manage_25.jpg" width="71" height="21" id="Image1" onmouseover="MM_swapImage('Image1','','/static/images/system/order_manage_h_25.jpg',1)" onmouseout="MM_swapImgRestore()" /></li>
        
        <li><a href="{{url_for('.view',action='print_barcode',id=header.id)}}" target="_blank"><img src="/static/images/system/order_manage_11_35.jpg" width="77" height="21" id="Image5" onmouseover="MM_swapImage('Image5','','/static/images/system/order_manage_1_35.jpg',1)" onmouseout="MM_swapImgRestore()" /></a></li>
        <li><img src="/static/images/system/order_manage_29.jpg" width="77" height="21" id="Image6" onmouseover="MM_swapImage('Image6','','/static/images/system/order_manage_h_29.jpg',1)" onmouseout="MM_swapImgRestore()" onclick="return todelete()"/></li>
        <!-- 
        <li><img src="/static/images/system/order_manage_35.jpg" width="94" height="21" id="Image4" onmouseover="MM_swapImage('Image4','','/static/images/system/order_manage_h_35.jpg',1)" onmouseout="MM_swapImgRestore()" /></li>
        <li><img src="/static/images/system/order_manage_41.jpg" width="101" height="21" id="Image7" onmouseover="MM_swapImage('Image7','','/static/images/system/order_manage_h_41.jpg',1)" onmouseout="MM_swapImgRestore()" /></li>
        -->
        <li style="padding:0px; margin:0px 55px 0px 0px; float:right"><a href="{{url_for('bpAuth.logout')}}"><img src="/static/images/system/order_manage_22.jpg" width="56" height="29" /></a></li>
    </ul>
</div>
{% endblock %}

{% block content %}
<input type="hidden" name="id" id="id" value="{{header.id}}">


<div class="order_add_div">
  <div class="order_add_div_header">{{_('Order Detail')}}</div>
    <div class="order_add_div_body">
    
    <div id="order_header">
  <ul>
    	<li style="width:180px;"><span><sup class="warn">*</sup>&nbsp;{{_('Source Station')}}</span>
    	  <input name="source_station" id="source_station" type="text" style="width:100px" value="{{header.source_station|f}}" class="must_input"/>
    	</li>    	
    	  <li style="width:180px;"><span><sup class="warn">*</sup>&nbsp;{{_('Destination Station')}}</span>
    	    <input name="destination_station" id="destination_station" type="text" style="width:100px" value="{{header.destination_station|f}}" class="must_input"/>
   	      </li>
    	  <li style="width:180px;"><span><sup class="warn">*</sup>&nbsp;单号</span>
    	    <input name="ref_no" id="ref_no" type="text" style="width:100px" value="{{header.ref_no|f}}" class="must_input"/>
  	    </li>
    	  <li style="width:300px;"><span>{{_('Create Time')}}</span>{{header.create_time|ft}}</li>
    	  <li style="width:459px;"><span><sup class="warn">*</sup>&nbsp;{{_('Source Company')}}</span>
    	    <input name="source_company" id="source_company" type="text" style="width:360px" value="{{header.source_company|f}}" class="must_input"/>
    	  </li>
    	  <li style="width:459px;"><span><sup class="warn">*</sup>&nbsp;{{_('Destination Company')}}</span>
    	    <input name="destination_company" id="destination_company" type="text" style="width:360px" value="{{header.destination_company|f}}" class="must_input"/>
    	  </li>
    	  <li style="width:459px;"><span><sup class="warn">*</sup>&nbsp;{{_('Source Contact')}}</span>
    	    <input name="source_contact" id="source_contact" type="text" style="width:360px" value="{{header.source_contact|f}}" class="must_input"/>
    	  </li>
    	  <li style="width:459px;"><span><sup class="warn">*</sup>&nbsp;{{_('Destination Contact')}}</span>
    	    <input name="destination_contact" id="destination_contact" type="text" style="width:360px" value="{{header.destination_contact|f}}" class="must_input"/>
    	  </li>
    	  <li style="width:459px;"><span>{{_('Source Address')}}</span>
    	    <input name="source_address" id="source_address" type="text" style="width:360px" value="{{header.source_address|f}}"/>
    	  </li>
    	  <li style="width:459px;"><span>{{_('Destination Address')}}</span>
    	    <input name="destination_address" id="destination_address" type="text" style="width:360px" value="{{header.destination_address|f}}"/>
    	  </li>
    	  <li style="width:227px;"><span>{{_('Source Phone')}}</span>
    	    <input name="source_tel" id="source_tel" type="text" style="width:140px" value="{{header.source_tel|f}}"/>
  	    </li>
    	  <li style="width:226px;"><span>{{_('Source Mobile')}}</span>
    	    <input name="source_mobile" id="source_mobile" type="text" style="width:140px" value="{{header.source_mobile|f}}"/>
  	    </li>
        <li style="width:227px;"><span>{{_('Destination Phone')}}</span>
    	    <input name="destination_tel" id="destination_tel" type="text" style="width:140px" value="{{header.destination_tel|f}}"/>
  	    </li>
    	  <li style="width:226px;"><span>{{_('Destination Mobile')}}</span>
    	    <input name="destination_mobile" id="destination_mobile" type="text" style="width:140px" value="{{header.destination_mobile|f}}"/>
  	    </li>
    	  <li style="width:227px;"><span>{{_('Pickup Type')}}</span>
    	  	<select name="pickup_type_id" id="pickup_type_id">
    	  		{% for p in pickup_type %}
    	  			{% if p.id == header.pickup_type_id %}
    	  				<option value="{{p.id}}" checked="checked">{{p}}</option>
    	  			{% else %}
    	  				<option value="{{p.id}}">{{p}}</option>
    	  			{% endif %}
    	  		{% endfor %}
    	    </select>
  	    </li>
    	  <li style="width:227px;"><span>{{_('Package Type')}}</span>
    	    <select name="pack_type_id" id="pack_type_id">
    	  		{% for p in pack_type%}
    	  			{% if p.id == header.pack_type_id %}
    	  				<option value="{{p.id}}" checked="checked">{{p}}</option>
    	  			{% else %}
    	  				<option value="{{p.id}}">{{p}}</option>
    	  			{% endif %}
    	  		{% endfor %}
    	    </select>
  	    </li>
  	    <li style="width:226px;"><span>{{_('Expect Time')}}</span>
    	    <input type="text" style="width:140px" id="expect_time" name="expect_time" class="datepicker" value="{{header.expect_time|fd}}"/>
  	    </li>
  	    <li style="width:226px;"><span>{{_('Actual Time')}}</span>
    	    <input type="text" style="width:140px" id="actual_time" name="actual_time" class="datepicker" value="{{header.actual_time|fd}}"/>
  	    </li>
    	  <li style="width:459px;"><span>{{_('Item')}}</span>
    	    <input name="item" id="item" type="text" style="width:360px" value="{{header.item|f}}"/>
  	    </li>
    	  <li style="width:925px;"><span>{{_('Item Remark')}}</span>
    	    <input name="item_remark" id="item_remark" type="text" style="width:840px" value="{{header.item_remark|f}}"/>
  	    </li>
    	  <li style="width:925px;"><span>{{_('Remark')}}</span>
    	    <textarea name="remark" id="remark" style="width:840px">{{header.remark|f}}</textarea>
  	    </li>
      </ul>
      
      
  <table width="100%" border="0" cellspacing="0" cellpadding="0" style="float:left;">
  <tr>
    <td width="9%" align="center">{{_('Qty')}}</td>
    <td width="9%" align="center">{{_('Qty Ratio')}}</td>
    <td width="9%" align="center">{{_('Weight')}}</td>
    <td width="9%" align="center">{{_('Weight Ratio')}}</td>
    <td width="9%" align="center">{{_('Vol')}}</td>
    <td width="9%" align="center">{{_('Vol Ratio')}}</td>
    <td width="9%" align="center"><sup class="warn">*</sup>&nbsp;{{_('Amount')}}</td>
    <td width="9%" align="center">{{_('Payment')}}</td>
    </tr>
  <tr>
    <td height="30" align="center"><span style="width:180px;">
      <input name="qty" id="qty" type="text" class="order_add_div_body_input numeric compute number_input_right" style="width:70px"  value="{{header.qty|f}}"/>
    </span></td>
    <td align="center"><span style="width:180px;">
      <input name="qty_ratio" id="qty_ratio" type="text" class="order_add_div_body_input numeric compute number_input_right" style="width:70px" value="{{header.qty_ratio|f}}"/>
    </span></td>
    <td align="center"><span style="width:180px;">
      <input name="weight" id="weight" type="text" class="order_add_div_body_input numeric compute number_input_right" style="width:70px" value="{{header.weight|f}}"/>
    </span></td>
    <td align="center"><span style="width:180px;">
      <input name="weight_ratio" id="weight_ratio" type="text" class="order_add_div_body_input numeric compute number_input_right" style="width:70px" value="{{header.weight_ratio|f}}"/>
    </span></td>
    <td align="center"><span style="width:180px;">
      <input name="vol" id="vol" type="text" class="order_add_div_body_input numeric compute number_input_right" style="width:70px" value="{{header.vol|f}}"/>
    </span></td>
    <td align="center"><span style="width:180px;">
      <input name="vol_ratio" id="vol_ratio" type="text" class="order_add_div_body_input numeric compute number_input_right" style="width:70px" value="{{header.vol_ratio|f}}"/>
    </span></td>
    <td align="center"><span style="width:180px;">
      <input name="amount" id="amount" type="text" class="order_add_div_body_input numeric must_input number_input_right" style="width:70px" value="{{header.amount|f}}"/>
    </span></td>
    <td align="center">
    	<span style="width:180px;">
	      <select name="payment_id" id="payment_id" class="order_add_div_body_input" style="width:70px">
				{% for p in payment %}
					{% if p.id == header.payment_id %}
						<option value="{{p.id}}" selected="selected">{{p}}</optino>
					{% else %}
						<option value="{{p.id}}">{{p}}</optino>
					{% endif %}
				{% endfor %}
			</select>
    	</span>
    </td>
    </tr>
</table>
	</div>

      <div style="clear:both"></div>

	<ul>
		<li><p>标记 <sup class="warn">*</sup> 的项为必填项。</p></li>
	</ul>
	
	<div style="clear:both"></div> 


<p align="center" style="height:30px;"><input type="image" src="/static/images/system/order_manage_33.jpg" width="77" height="21" onclick="save_header()"/></p>

<div class="order_add_info_tab_div">
	<div class="order_add_info_tab_header">
		<ul>
			<li><a href="#tabs-1">货物详情</a></li>
			<li><a href="#tabs-2">派遣收件人</a></li>
			<li><a href="#tabs-3">仓存信息</a></li>
			<li><a href="#tabs-4">运输信息</a></li>
			<li><a href="#tabs-5">签收信息</a></li>
			<li><a href="#tabs-6">提货信息</a></li>
			<li><a href="#tabs-7">财务信息</a></li>
			<li><a href="#tabs-8">历史记录</a></li>
		</ul>
	</div>
	
	
	<!-- item info -->
    <div class="order_add_info_tab_body" id="tabs-1">
			<div id="item_details">
				<table>
				<tr>
					<td valign="top" width="70px"><sup class="warn">*</sup>&nbsp;{{_('Item Name')}}</td>
					<td valign="top"><input type="text" name="item_name" id="item_name" value="" class="must_input" style="width:140px;"></td>
					<td valign="top" width="70px" align="center"><sup class="warn">*</sup>&nbsp;{{_('Qty')}}</td>
					<td valign="top"><input type="text" name="item_qty" id="item_qty" value="" class="numeric must_input" style="width:80px;"/></td>
					<td valign="top" width="70px" align="center">{{_('Vol')}}</td>
					<td valign="top"><input type="text" name="item_vol" id="item_vol" value="" class="numeric order_add_div_body_input" style="width:80px;"/></td>
					<td valign="top" width="70px" align="center">{{_('Weight')}}</td>
					<td valign="top"><input type="text" name="item_weight" id="item_weight" value="" class="numeric order_add_div_body_input" style="width:80px;"/></td>
				    <td valign="top" width="70px" align="center">{{_('Remark')}}</td>
				    <td valign="top"><textarea name="item_remark" id="item_remark"></textarea></td></tr>
				</table>
				<p><input type="button" value="{{_('Add')}}" onclick="save_item()"/></p>
			</div>
			<br />
			<table>
				<thead>
					<tr class="field_head">
						<th align="center">{{_('Item Name')}}</th>
						<th align="center">{{_('Qty')}}</th>
						<th align="center">{{_('Vol')}}</th>
						<th align="center">{{_('Weight')}}</th>
						<th align="center">{{_('Remark')}}</th>
						<td>&nbsp;</td>
					</tr>
				</thead>
				<tbody id="item_list">
				{% for l in header.item_details %}
					<tr class="data_table_tr">
						<th>{{l.item|f}}</td>
						<td>{{l.qty|f}}</td>
						<td>{{l.vol|f}}</td>
						<td>{{l.weight|f}}</td>
						<td>{{l.remark|f}}</td>
						<td><input type="button" value="{{_('Del')}}" onclick="del_item({{l.id}},this)"/></td>
					</tr>
				{% endfor %}
			</tbody>
			</table>
          <div style="clear:both"><br /></div>
	</div>
       
       
 
  
  <!-- receiver info -->
  <div class="order_add_info_tab_body" id="tabs-2">
		<div>
			<table>
				<tr>
					<td valign="top" width="80px"><sup class="warn">*</sup>&nbsp;收件联系人</td>
					<td valign="top"><input type="text" name="receiver_contact" id="receiver_contact" value="{{header.receiver_contact|f}}" class="must_input" style="width:140px;"/></td>
					<td valign="top" width="80px" align="center">联系人电话</td>
					<td valign="top"><input type="text" name="receiver_tel" id="receiver_tel" value="{{header.receiver_tel|f}}" class="order_add_div_body_input" style="width:120px;"/></td>
					<td valign="top" width="80px" align="center">联系手机</td>
					<td valign="top"><input type="text" name="receiver_mobile" id="receiver_mobile" value="{{header.receiver_mobile|f}}" class="order_add_div_body_input" style="width:120px;"/></td>
					<td valign="top" width="80px" align="center">备注</td>
					<td valign="top"><textarea name="receiver_remark" id="receiver_remark">{{header.receiver_remark|f}}</textarea></td>
				</tr>
			</table>
			<p><input type="button" value="确认派遣收件人" onclick="save_receiver()"/></p>
		</div>
	</div>



	<!-- warehouse info -->
	<div class="order_add_info_tab_body" id="tabs-3">
		{% if header.status < IN_WAREHOUSE[0] %}
			<p>入仓信息</p>
			<table>
				<tr>
					<td><sup class="warn">*</sup>{{_('Time')}}</td><td><input type="text" name="wh_time" id="wh_time" value="{{SYSTEM_NOW()|fd}}" class="datepicker"/></td>
				</tr>
				<!-- 
				<tr>
					<td>仓位</td><td><input type="text" name="wh_location" id="wh_location" value=""/></td>
				</tr>
				-->
				<tr>
					<td>{{_('Remark')}}</td><td><textarea name="wh_remark" id="wh_remark">订单: {{header.ref_no}} 确认入仓</textarea></td>
				</tr>
			</table>
			<p><input type="button" value="确认入仓" onclick="save_warehouse('IN')"/></p>
			
		{% elif  header.status < OUT_WAREHOUSE[0] %}
			<p>出仓信息</p>
			<table>
				<tr>
					<td><sup class="warn">*</sup>{{_('Time')}}</td><td><input type="text" name="wh_time" id="wh_time" value="{{SYSTEM_NOW()|fd}}" class="datepicker"/></td>
				</tr>
				<tr>
					<td>{{_('Remark')}}</td><td><textarea name="wh_remark" id="wh_remark">订单: {{header.ref_no}} 确认出仓</textarea></td>
				</tr>
			</table>
			<p><input type="button" value="确认出仓" onclick="save_warehouse('OUT')"/></p>
		{% else %}
			<p>货物已出仓。<p>
		{% endif %}
	</div>


	<!-- transit info -->
	<div class="order_add_info_tab_body" id="tabs-4">
		<div>
			<table>
				<tr>
					<td valign="top" width="80px" align="center"><sup class="warn">*</sup>&nbsp;{{_('Time')}}</td>
					<td valign="top"><input type="text" name="transit_action_time" id="transit_action_time" value="" class="datepicker must_input"/></td>
					<td valign="top" width="80px" align="center">{{_('Remark')}}</td>
					<td valign="top"><textarea name="transit_remark" id="transit_remark" style="width:500px;"></textarea></td>
				</tr>
			</table>
			<p><input type="button" value="{{_('Add')}}" onclick="save_transit()"/></p>
		</div>
		<br />
		<table>
			<thead>
				<tr class="field_head">
					<th align="center">{{_('Time')}}</th>
					<th align="center" style="width:600px">{{_('Remark')}}</th>
				</tr>
			<thead>
			<tbody id="transit_list">
				{% for t in transit_logs %}
					<tr class="data_table_tr">
						<td>{{t.transfer_date|ft}}</td>
						<td>{{t.remark|f}}</td>
						<!-- 
						<td><input type="button" value="{{_('Del')}}" onclick="del_transit({{t.id}},this)"/></td>
						 -->
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>

	<!-- signed info -->
	<div class="order_add_info_tab_body" id="tabs-5">
		<div>
			<table>
				<tr>
					<td valign="top" width="80px"><sup class="warn">*</sup>&nbsp;签收联系人</td>
					<td valign="top"><input type="text" name="signed_contact" id="signed_contact" value="{{header.signed_contact|f}}" class="must_input" style="width:140px;"/></td>
					<td valign="top" width="80px" align="center"><sup class="warn">*</sup>&nbsp;签收日期</td>
					<td valign="top"><input type="text" name="signed_time" id="signed_time" value="{{header.signed_time|f}}" class="datepicker must_input"/></td>
					<td valign="top" width="80px" align="center">联系人电话</td>
					<td valign="top"><input type="text" name="signed_tel" id="signed_tel" value="{{header.signed_tel|f}}" class="order_add_div_body_input" style="width:120px;"/></td>
					<td valign="top" width="80px" align="center">备注</td>
					<td valign="top"><textarea name="signed_remark" id="signed_remark">{{header.signed_remark|f}}</textarea></td>
				</tr>
			</table>
			<p><input type="button" value="保存" onclick="save_signed()"/></p>
		</div>
	</div>

	<!-- pickup info -->
	<div class="order_add_info_tab_body" id="tabs-6">
		<div>
			<table>
				<tr>
					<td valign="top" width="40px"><sup class="warn">*</sup>&nbsp;{{_('Time')}}</td>
					<td valign="top"><input type="text" name="pickup_action_time" id="pickup_action_time" value="" class="datepicker must_input"/></td>
					<td valign="top" width="80px" align="center"><sup class="warn">*</sup>&nbsp;{{_('Pickup Contact')}}</td>
					<td valign="top"><input type="text" name="pickup_contact" id="pickup_contact" value="" class="must_input"/></td>
					<td valign="top" width="80px" align="center">{{_('Contact Tel')}}</td>
					<td valign="top"><input type="text" name="pickup_tel" id="pickup_tel" value="" class="order_add_div_body_input" style="width:110px;"/></td>
					<td valign="top" width="80px" align="center"><sup class="warn">*</sup>&nbsp;{{_('Pickup Qty')}}</td>
					<td valign="top"><input type="text" name="pickup_qty" id="pickup_qty" value="" class="numeric must_input" style="width:70px;"/></td>
					<td valign="top" width="50px" align="center">{{_('Remark')}}</td>
					<td valign="top"><textarea name="pickup_remark" id="pickup_remark"></textarea></td>
				</tr>
			</table>
			<p><input type="button" value="{{_('Save')}}" onclick="save_pickup()"/></p>
		</div>
		<br />
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<thead>
				<tr class="field_head">
					<th align="center">{{_('Time')}}</th>
					<th align="center">{{_('Pickup Contact')}}</th>
					<th align="center">{{_('Contact Tel')}}</th>
					<th align="center">{{_('Pickup Qty')}}</th>
					<th align="center">{{_('Remark')}}</th>
					<th>&nbsp;</th>
				</tr>
			<thead>
			<tbody id="pickup_list">
				{% for t in header.pickup_details %}
					<tr class="data_table_tr">
						<td>{{t.action_time|f}}</td>
						<td>{{t.contact|f}}</td>
						<td>{{t.tel|f}}</td>
						<td>{{t.qty|f}}</td>
						<td>{{t.remark|f}}</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>

	<!-- fin info -->
	<div class="order_add_info_tab_body" id="tabs-7">
	
	</div>
	
	
	<!-- history info -->
	<div class="order_add_info_tab_body" id="tabs-8">
	
	</div>
</div>


</div>
</div>

{% endblock %}